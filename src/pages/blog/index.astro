---
import Header from '../../components/Header.astro';
import Sidebar from '../../components/Sidebar.astro';
import { getCollection } from 'astro:content';

// Ambil semua post (kecuali draft) dan urutkan terbaru dulu
const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<!DOCTYPE html>
<html>
  <Header title="Blog | Erland" />
  <body>
    <div class="content">
      <Sidebar selectedItem="blog" />
      <nav class="main">
        <div class="container">
          <div class="back-nav-container">
            <a href="/" class="back-nav-button w-inline-block">
              <img src="/assets/back.svg" loading="lazy" alt="" class="back-nav-img" />
              <div>Back</div>
            </a>
          </div>

          <div class="content-container">
            <h1>Blog</h1>
            <section class="items-container">
              <div class="resouce-items">
                {posts.map((post) => (
                  <a href={`/blog/${post.slug}/`} class="w-inline-block" style="text-decoration:none;">
                    <article
                      class="resource-card"
                      style="
                        border: 1px solid var(--border, rgba(0,0,0,.08));
                        border-radius: 12px;
                        padding: 16px 18px;
                        transition: transform .12s ease, box-shadow .12s ease;
                      "
                    >
                      <header style="display:flex; gap:.5rem; align-items:baseline; flex-wrap:wrap;">
                        <h2 style="margin:0; font-size:1.125rem; font-weight:700;">
                          {post.data.title}
                        </h2>
                        <time
                          datetime={post.data.publishDate.toISOString()}
                          style="opacity:.7; font-size:.9rem;"
                        >
                          {post.data.publishDate.toLocaleDateString('id-ID', { dateStyle: 'medium' })}
                        </time>
                      </header>

                      {post.data.description && (
                        <p style="margin:.5rem 0 0; opacity:.9;">
                          {post.data.description}
                        </p>
                      )}

                      {post.data.tags?.length > 0 && (
                        <ul style="display:flex; gap:.5rem; margin:.75rem 0 0; padding:0; list-style:none;">
                          {post.data.tags.map((t) => (
                            <li
                              style="
                                padding:.2rem .6rem;
                                border:1px solid var(--border, rgba(0,0,0,.08));
                                border-radius:999px;
                                font-size:.8rem;
                                opacity:.9;
                              "
                            >
                              {t}
                            </li>
                          ))}
                        </ul>
                      )}
                    </article>
                  </a>
                ))}
                
                {posts.length === 0 && (
                  <p style="opacity:.8;">Belum ada tulisan. Tambahkan file di <code>src/content/blog/</code> ya ✍️</p>
                )}
              </div>
            </section>
          </div>
        </div>
      </nav>
    </div>

    <style>
      .resource-card:hover {
        transform: translateY(-2px);
      }
    </style>

    <!--[if lte IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif]-->
  </body>
</html>
