---
import Icon from "./Icon.astro";
import styles from "./PostCard/post-card.module.css";
import { slugifyCategory } from "@lib/blog";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
  href: string;
  title: string;
  hero?: ImageMetadata | null;
  alt: string;
  category?: string | null;
  dateLabel?: string | null;
  excerpt?: string | null;
}

const { href, title, hero, alt, category, dateLabel, excerpt } = Astro.props as Props;
const categoryHref = category ? `/blog/category/${slugifyCategory(category)}/` : null;
---

<article class:list={[styles['resource-card'], 'resource-card', 'post-card']}>
  <div class={styles["post-card__inner"]}>
    <div class={styles["post-card__thumb"]}>
      {hero ? (
        <Image
          src={hero}
          alt={alt}
          loading="lazy"
          widths={[128, 256, 320]}
          sizes="(max-width: 600px) 260px, 128px"
          class={styles["post-card__img"]}
        />
      ) : (
        <div class={styles["post-card__thumb--placeholder"]} aria-hidden="true"></div>
      )}
    </div>
    <div class={styles["post-card__body"]}>
      <header class={styles["post-card__header"]}>
        <h2 class={styles["post-card__title"]}>
          <a href={href} class={styles["post-card__title-link"]}>{title}</a>
        </h2>
        <div class={styles["post-card__meta"]}>
          {category && (
            <div class={styles["post-card__meta-item"]}>
              <Icon name="tags" class={styles["post-card__meta-icon"]} />
              <a href={categoryHref!} class={styles["post-card__category"]}>{category}</a>
            </div>
          )}
          {dateLabel && (
            <div class={styles["post-card__meta-item"]}>
              <Icon name="date" class={styles["post-card__meta-icon"]} />
              <time class={styles["post-card__date"]}>{dateLabel}</time>
            </div>
          )}
        </div>
      </header>
      {excerpt && <p class={styles["post-card__excerpt"]}>{excerpt}</p>}
      <a href={href} class:list={[styles["post-card__readmore"], 'btn']}>
        <span>Read more</span>
        <Icon name="readmore" class={styles["post-card__readmore-icon"]} />
      </a>
    </div>
  </div>
</article>
