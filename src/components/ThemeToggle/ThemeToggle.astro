---
/**
 * ThemeToggle Component
 * 
 * Theme switcher dropdown with three options: Auto (system default), Light Mode, and Dark Mode.
 * Persists user preference to localStorage and syncs across page navigations.
 * 
 * Features:
 * - System default theme detection (prefers-color-scheme)
 * - Manual theme override (light/dark)
 * - Pre-hydration icon injection to prevent FOUC
 * - Keyboard navigation support
 * - ARIA menu pattern for accessibility
 * 
 * Theme state managed by:
 * - Client-side JavaScript in @lib/theme-toggle.ts
 * - Critical init script in CriticalInit.astro
 * - CSS custom properties on document root
 * 
 * @component
 * @example
 * <ThemeToggle />
 */
import Icon from '@components/Icon.astro';
import styles from './ThemeToggle.module.css';

// Import theme icon SVGs for pre-hydration injection
import autoIconRaw from '@/icons/theme-auto.svg?raw';
import lightIconRaw from '@/icons/theme-light.svg?raw';
import darkIconRaw from '@/icons/theme-dark.svg?raw';

// Prepare icons for inline script with exact same styles as .svg class
const iconStyles =
  'style="width:24px;height:24px;display:block;margin:0;padding:0"';
const icons = {
  auto: autoIconRaw.replace('<svg', `<svg ${iconStyles}`),
  light: lightIconRaw.replace('<svg', `<svg ${iconStyles}`),
  dark: darkIconRaw.replace('<svg', `<svg ${iconStyles}`),
};
---

<div class:list={[styles.wrapper, 'theme-toggle']}>
  <button
    type='button'
    class:list={[styles.trigger, 'theme-toggle__trigger']}
    data-theme-trigger
    aria-expanded='false'
    aria-controls='theme-flyout'
    aria-label='Theme settings'
    title='Theme settings'
  >
    <span class:list={[styles.triggerIcon, 'theme-toggle__trigger-icon']}>
      <Icon name='themeDark' class={styles.svg} data-theme-trigger-icon />
    </span>
  </button>

  <div
    id='theme-flyout'
    class:list={[styles.flyout, 'theme-toggle__flyout']}
    role='menu'
    aria-label='Theme options'
    hidden
  >
    <button
      type='button'
      class:list={[styles.option, 'theme-toggle__option']}
      role='menuitemradio'
      data-theme-option='auto'
      data-active='false'
      aria-checked='false'
    >
      <span class={styles.optionIcon}>
        <Icon name='themeAuto' class={styles.optionSvg} />
      </span>
      <span class={styles.optionLabel}>System Default</span>
    </button>

    <button
      type='button'
      class:list={[styles.option, 'theme-toggle__option']}
      role='menuitemradio'
      data-theme-option='light'
      aria-checked='false'
    >
      <span class={styles.optionIcon}>
        <Icon name='themeLight' class={styles.optionSvg} />
      </span>
      <span class={styles.optionLabel}>Light Mode</span>
    </button>

    <button
      type='button'
      class:list={[styles.option, 'theme-toggle__option']}
      role='menuitemradio'
      data-theme-option='dark'
      data-active='true'
      aria-checked='true'
    >
      <span class={styles.optionIcon}>
        <Icon name='themeDark' class={styles.optionSvg} />
      </span>
      <span class={styles.optionLabel}>Dark Mode</span>
    </button>
  </div>

  <div
    id='theme-status'
    class='visually-hidden'
    role='status'
    aria-live='polite'
    aria-atomic='true'
  >
  </div>
</div>

<script is:inline define:vars={{ icons }}>!function(){try{var e=localStorage.getItem("theme-preference"),t=e==="light"||e==="dark"||e==="auto"?e:"dark",r=document.currentScript;if(r){var n=r.previousElementSibling;if(n&&n.classList.contains("theme-toggle")){var i=n.querySelector(".theme-toggle__trigger-icon");i&&icons[t]&&(i.innerHTML=icons[t])}}}catch(e){}}();</script>
