---
import Icon from '@components/Icon.astro';
import styles from './share-buttons.module.css';

interface Props {
  title: string;
  url: string; // absolute URL
  description?: string;
  heading?: string;
}

const {
  title,
  url,
  description,
  heading = 'Share this article:',
}: Props = Astro.props as Props;

function withUtm(baseUrl: string, source: string) {
  const u = new URL(baseUrl);
  u.searchParams.set('utm_source', source);
  u.searchParams.set('utm_medium', 'social');
  u.searchParams.set('utm_campaign', 'share-button');
  return u.toString();
}

const shareUrlCopy = withUtm(url, 'copy');
const shareUrlWebShare = withUtm(url, 'webshare');
const shareUrlWhatsapp = withUtm(url, 'whatsapp');
const shareUrlTelegram = withUtm(url, 'telegram');
const shareUrlTwitter = withUtm(url, 'twitter');
const shareUrlFacebook = withUtm(url, 'facebook');
const shareUrlLinkedIn = withUtm(url, 'linkedin');

const enc = encodeURIComponent;

// Intent URLs (fallback)
const whatsappHref = `https://wa.me/?text=${enc(`${title} â€” ${shareUrlWhatsapp}`)}`;
const telegramHref = `https://t.me/share/url?url=${enc(shareUrlTelegram)}&text=${enc(title)}`;
const twitterHref = `https://x.com/intent/post?url=${enc(shareUrlTwitter)}&text=${enc(title)}`;
const facebookHref = `https://www.facebook.com/sharer/sharer.php?u=${enc(shareUrlFacebook)}`;
const linkedinHref = `https://www.linkedin.com/sharing/share-offsite/?url=${enc(shareUrlLinkedIn)}`;
---

<section
  class='share'
  data-title={title}
  data-text={description || title}
  data-url={shareUrlWebShare}
>
  <h3 class={styles['share__title']}>{heading}</h3>

  <div class={styles['share__wrap']}>
    <div class:list={[styles['share__native'], 'share__native']} hidden>
      <button
        class:list={[styles['share__btn'], 'share__btn--native']}
        type='button'
        aria-label='Share via native share'
      >
        <Icon name='share' class={styles['share__icon']} ariaLabel='Share' />
      </button>
      <button
        class:list={[styles['share__btn'], 'share__btn--copy']}
        type='button'
        aria-label='Copy link'
        data-copy={shareUrlCopy}
      >
        <Icon name='copy' class={styles['share__icon']} ariaLabel='Copy link' />
      </button>
    </div>

    <div class={styles['share__fallback']}>
      <a
        class={styles['share__btn']}
        href={whatsappHref}
        target='_blank'
        rel='noopener noreferrer'
        aria-label='Share on WhatsApp'
      >
        <Icon
          name='whatsapp'
          class={styles['share__icon']}
          ariaLabel='WhatsApp'
        />
      </a>
      <a
        class={styles['share__btn']}
        href={telegramHref}
        target='_blank'
        rel='noopener noreferrer'
        aria-label='Share on Telegram'
      >
        <Icon
          name='telegram'
          class={styles['share__icon']}
          ariaLabel='Telegram'
        />
      </a>
      <a
        class={styles['share__btn']}
        href={twitterHref}
        target='_blank'
        rel='noopener noreferrer'
        aria-label='Share on X/Twitter'
      >
        <Icon name='x' class={styles['share__icon']} ariaLabel='X / Twitter' />
      </a>
      <a
        class={styles['share__btn']}
        href={facebookHref}
        target='_blank'
        rel='noopener noreferrer'
        aria-label='Share on Facebook'
      >
        <Icon
          name='facebook'
          class={styles['share__icon']}
          ariaLabel='Facebook'
        />
      </a>
      <a
        class={styles['share__btn']}
        href={linkedinHref}
        target='_blank'
        rel='noopener noreferrer'
        aria-label='Share on LinkedIn'
      >
        <Icon
          name='linkedin'
          class={styles['share__icon']}
          ariaLabel='LinkedIn'
        />
      </a>
    </div>
  </div>
</section>
