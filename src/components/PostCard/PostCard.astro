---
/**
 * PostCard Component
 *
 * Displays a blog post preview card with thumbnail, title, excerpt, category, and date.
 * Used in blog listing pages to show post previews in a grid layout.
 *
 * @component
 * @example
 * <PostCard
 *   href="/blog/my-post/"
 *   title="Post Title"
 *   hero={heroImage}
 *   alt="Hero image description"
 *   category="Technology"
 *   dateLabel="Jan 1, 2024"
 *   excerpt="Brief post description..."
 * />
 *
 * @param {Object} props
 * @param {string} props.href - Post URL (absolute or relative path)
 * @param {string} props.title - Post title displayed in card header
 * @param {ImageMetadata | null} [props.hero] - Hero image from content collection (optional)
 * @param {string} props.alt - Alt text for hero image (required for accessibility)
 * @param {string | null} [props.category] - Post category (optional, generates link to category page)
 * @param {string | null} [props.dateLabel] - Formatted date string (optional, e.g., "Jan 15, 2024")
 * @param {string | null} [props.excerpt] - Post excerpt/description (optional)
 */
import Icon from '@components/Icon.astro';
import { slugifyCategory } from '@lib/content/blog';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { getCardImageConfig } from '@lib/content/images';
import styles from './post-card.module.css';

interface Props {
  href: string;
  title: string;
  hero?: ImageMetadata | null;
  alt: string;
  category?: string | null;
  dateLabel?: string | null;
  excerpt?: string | null;
}

const { href, title, hero, alt, category, dateLabel, excerpt } =
  Astro.props as Props;
// Generate category URL if category exists (slugified for URL compatibility)
const categoryHref = category
  ? `/blog/category/${slugifyCategory(category)}/`
  : null;
// Get responsive image configuration for card thumbnails
const { widths, sizes } = getCardImageConfig();
---

<!-- Blog Post Preview Card - Grid item for blog listing pages -->
<article class:list={[styles['resource-card'], 'resource-card', 'post-card']}>
  <div class={styles['post-card__inner']}>
    <!-- Thumbnail Section - Conditional: Optimized hero image if available, placeholder otherwise -->
    <div class={styles['post-card__thumb']}>
      {
        hero ? (
          <Image
            src={hero}
            alt={alt}
            loading='lazy'
            widths={widths}
            sizes={sizes}
            class={styles['post-card__img']}
          />
        ) : (
          <div
            class={styles['post-card__thumb--placeholder']}
            aria-hidden='true'
          />
        )
      }
    </div>

    <!-- Card Content Section - Title, metadata, excerpt, CTA -->
    <div class={styles['post-card__body']}>
      <!-- Card Header - Title and metadata (category, date) -->
      <header class={styles['post-card__header']}>
        <!-- Post Title - Clickable link to full post -->
        <h2 class={styles['post-card__title']}>
          <a href={href} class={styles['post-card__title-link']}>{title}</a>
        </h2>

        <!-- Post Metadata - Conditional: Shows category and/or date if available -->
        <div class={styles['post-card__meta']}>
          {
            category && (
              <div class={styles['post-card__meta-item']}>
                <Icon name='blogTags' class={styles['post-card__meta-icon']} />
                <a href={categoryHref!} class={styles['post-card__category']}>
                  {category}
                </a>
              </div>
            )
          }
          {
            dateLabel && (
              <div class={styles['post-card__meta-item']}>
                <Icon name='blogDate' class={styles['post-card__meta-icon']} />
                <time class={styles['post-card__date']}>{dateLabel}</time>
              </div>
            )
          }
        </div>
      </header>

      {/* Conditional: Post excerpt paragraph (only if excerpt exists) */}
      {excerpt && <p class={styles['post-card__excerpt']}>{excerpt}</p>}

      <!-- Call-to-Action Button - Link to full post -->
      <a href={href} class:list={[styles['post-card__readmore'], 'btn']}>
        <span>Read more</span>
        <Icon name='blogReadmore' class={styles['post-card__readmore-icon']} />
      </a>
    </div>
  </div>
</article>
